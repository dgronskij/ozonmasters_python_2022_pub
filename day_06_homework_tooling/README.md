# day_06_homework_tooling

[TOC]

# UPDATES

# ETA

| Старт задания          | Решения принимаются до |
| ---------------------- | ---------------------- |
| 2022-03-31 23:59 (Thu) | 2022-04-06 23:59 (Wed) |

Обращаем внимание, что задание **на одну неделю**

Вам созданы личные проекты в группе python_2_2022/<user>
У вас там есть права Developer -- это значит, что вы можете пушить в незащищенные ветки.
Ветка `main/master` -- защищенная, поэтому ведите работу в какой-то другой, например, `dev`


В качестве решения принимается Merge Request из вашей рабочей ветки в `main/master` вашей личной репы.
Обращаем внимание, что мы видим только НЕ Draft: MR-ы

# О задании и его структуре

В этом задании мы будем настраивать тулинг и интегрировать его c CI/CD.

Оно состоит из блоков:

* poetry как менеджер пакетов
* black как форматтер кода
* isort как форматтер импортов
* pylint как линтер
* mypy как статический линтер

Задание можно сдать только по базовому треку. Все пункты – обязательные :)

# Задание

## Базовая джоба

* [ ] Создайте в .gitlab-ci.yml джобу под названием “.poetry-base” которая
    * [ ] Использует образ python3.8
    * [ ] **НЕ** определяет stage
    * [ ] В секции `variables` определяет переменную окружения
       * `POETRY_VERSION` = 1.1.13
    * [ ] В секции `before_script`
        * [ ] Устанавливает poetry c версией POETRY_VERSION через pip
            * Для домашних инсталляций устанавливать poetry через pip нельзя, в контексте CI с фиксированной версией питона – можно
        * [ ] Делает `poetry install`. Посмотрите описание команды. Сделайте так, чтобы в окружение установились dev пакеты и наш целевой пакет
* [ ] Определите в глобальном уровне стейджи
    * linter
    * test

## Настройка окружения

Мы воспользовались командой `poetry new`, чтобы создать вам типовую структуру проекта.

С помощью команды `poetry add` доустановите в окружение **как dev зависимость** пакеты:

* [ ] `pytest`
* [ ] Поставить `black`, ограничив версию таким образом, чтобы могли ставиться
    * Версии `22.*` старше либо равные `22.1`
    * Воспользуйтесь [докой](https://python-poetry.org/docs/dependency-specification)
* [ ] `mypy` версии `0.942`
* [ ] `pylint`
* [ ] Убедитесь, что poetry.lock файл закомичен в гит ([почему это нужно делать](https://python-poetry.org/docs/basic-usage/#commit-your-poetrylock-file-to-version-control))

## black

* [ ] C помощью pyproject.toml настройте black так, чтобы максимальная длина строки была равна 90 -- [дока](https://black.readthedocs.io/en/stable/usage_and_configuration/the_basics.html#what-on-earth-is-a-pyproject-toml-file)
* [ ]  Добавьте в .gitlab-ci.yml джобу
    * [ ] С названием `black`
    * [ ] В стейдже `linter`
    * [ ] Наследуется от `.poetry-base`
    * [ ] Которая **проверяет** (не форматирует, а именно проверяет), что файлы отформатированы правильно

## isort

* [ ] Настройте через `pyproject.toml` [интеграцию с black](https://pycqa.github.io/isort/docs/configuration/black_compatibility.html)
* [ ] Настройте через `pyproject.toml` [максимальную длину сроки](https://pycqa.github.io/isort/docs/configuration/options.html#line-length)
* [ ] Добавьте в `.gitlab-ci.yml` джобу
    * [ ] С названием `isort`
    * [ ] В стейдже `linter`
    * [ ] Наследуется от `.poetry-base`
    * [ ] Которая **проверяет** (не форматирует, а именно проверяет), что файлы отформатированы правильно

## pylint

* [ ] Добавьте в `.gitlab-ci.yml` джобу
    * [ ]  С названием `pylint`
    * [ ]  В стейдже `linter`
    * [ ]  Наследуется от `.poetry-base`
    * [ ]  Которая запускает `pylint`

## mypy

* [ ] С помощью файла `mypy.ini` конфигуририует `mypy`:
    * [ ]  Настраивает версию питона
    * [ ]  Включает [strict режим](https://mypy.readthedocs.io/en/stable/config_file.html#confval-strict)
    * [ ]  Не проверяет файлы с тестами
* [ ] Добавьте в `.gitlab-ci.yml` джобу
    * [ ]  С названием `mypy`
    * [ ]  В стейдже `linter`
    * [ ]  Наследуется от `.poetry-base`
    * [ ]  Которая запускает `mypy`

## pytest

* [ ] Добавьте в `.gitlab-ci.yml` джобу
    * [ ]  С названием `pytest`
    * [ ]  В стейдже `test`
    * [ ]  Наследуется от `.poetry-base`
    * [ ]  Которая запускает `pytest`

## Задание

Вам нужно поправить код сортировки слиянием таким образом, чтобы:

* [ ] Линтеры проходили
* [ ] Код приятно выглядел
* [ ] Код правильно работал (исходный код работает неправильно)
* [ ] Написать какие-то тесты
    * [ ] Тесты, как минимум, должны включать в себя тест, на котором исходный код ломается
